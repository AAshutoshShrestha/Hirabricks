{% extends "base.html" %}
{% block title %}Sales List | Your Site Name{% endblock %}

{% block content %}

<div class="rounded-xl border border-gray-300 bg-white p-3 shadow-lg sm:p-7 dark:bg-slate-900">
  <div class="border-b border-gray-100 px-6 py-4">
    <h2 class="font-medium text-gray-600 dark:text-gray-400">All Sales Records</h2>
  </div>
  <form class="mx-auto mb-12 rounded-xl border border-gray-300 bg-white px-12 py-12 shadow-lg dark:bg-slate-900" action="{% url 'sales_list' %}" method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="mb-5">{{ forms.as_p }}</div>
    <button type="submit" class="mt-4 w-full rounded-lg bg-red-700 px-5 py-2.5 text-center text-sm font-medium text-white hover:bg-red-800 focus:outline-none focus:ring-4 focus:ring-red-300 sm:w-auto dark:bg-red-600 dark:hover:bg-red-700 dark:focus:ring-red-800">Submit</button>
    {% for message in messages %}
    <p id="bg-green-500 px-4 py-6">{{message}}</p>
    {% endfor %}
  </form>

  <div class="rounded-xl border border-gray-300 bg-white p-3 shadow-lg sm:p-7 dark:bg-slate-900">
    <div class="border-b border-gray-100 px-6 py-4">
      <h3 class="font-medium text-gray-600 dark:text-gray-400">All Sales Details</h3>
    </div>

    <div class="mx-auto max-w-7xl overflow-hidden px-8">
      <div class="py-8">
        <div class="-mx-4 overflow-x-auto px-4 py-4 sm:-mx-8 sm:px-8">
          <div class="inline-block min-w-full overflow-hidden rounded-lg shadow">
            <table class="min-w-full leading-normal">
              <thead>
                <tr>
                  <th scope="col" class="border-b border-gray-200 bg-white px-5 py-3 text-left text-sm font-normal uppercase text-gray-800">No.</th>
                  <th scope="col" class="border-b border-gray-200 bg-white px-5 py-3 text-left text-sm font-normal uppercase text-gray-800">Date Sold at</th>
                  <th scope="col" class="border-b border-gray-200 bg-white px-5 py-3 text-left text-sm font-normal uppercase text-gray-800">Product Name</th>
                  <th scope="col" class="border-b border-gray-200 bg-white px-5 py-3 text-left text-sm font-normal uppercase text-gray-800">Quantity Sold</th>
                </tr>
              </thead>
              <tbody>
                {% for sale in sales %}
                <tr>
                  <td class="border-b border-gray-200 bg-white px-5 py-5 text-sm">
                    <p class="whitespace-no-wrap text-gray-900">{{ forloop.counter }}</p>
                  </td>

                  <td class="border-b border-gray-200 bg-white px-5 py-5 text-sm">
                    <p class="whitespace-no-wrap text-gray-900">{{ sale.date_sold }}</p>
                  </td>
                  <td class="border-b border-gray-200 bg-white px-5 py-5 text-sm">
                    <p class="whitespace-no-wrap text-gray-900">{{ sale.product.name }}</p>
                  </td>
                  <td class="border-b border-gray-200 bg-white px-5 py-5 text-sm">
                    <p class="whitespace-no-wrap text-gray-900">{{ sale.quantity_sold }}</p>
                  </td>
                </tr>
                {% endfor%}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<script>
  function update_product_attribute_choices() {
      // Get the selected product value from the product dropdown
      var selectedProductId = document.getElementById('id_product').value;
      
      // Fetch product attributes based on the selected product using AJAX
      fetch('/get_product_attributes/?product_id=' + selectedProductId)
          .then(response => response.json())
          .then(data => {
              // Clear existing options
              var productAttributeDropdown = document.getElementById('id_product_attribute');
              productAttributeDropdown.innerHTML = '';
              
              // Populate the product attribute dropdown with the fetched data
              data.forEach(function(attribute) {
                  var option = document.createElement('option');
                  option.value = attribute.id;
                  option.textContent = attribute.name;
                  productAttributeDropdown.appendChild(option);
              });
          })
          .catch(error => console.error('Error fetching product attributes:', error));
  }
  </script>


{% endblock %}
